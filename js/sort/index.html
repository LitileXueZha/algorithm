<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>排序</title>
    <script type="text/javascript">
      Array.prototype.swap = function (i, j) {
        const tmp = this[i];
        this[i] = this[j];
        this[j] = tmp;
      };

      function partion(arr, start, end) {
        const radix = arr[start];
        console.log(start, radix, arr, end);
        let i = start;
        let j = end + 1;
        while (true) {
          while (arr[++ i] < radix) {
            if (i === start) break;
          }
          while (arr[-- j] > radix) {
            if (j === end) break;
          }

          if (i >= j) break;
          arr.swap(i, j);
        }
        arr.swap(start, j);
        return j;
      }

      class Sort {
        //  冒泡
        static bubble(arr) {
          for (let i = 0;i < arr.length - 1;i ++) {
            for (let j = 0; j < arr.length - i - 1;j ++) {
              if (arr[j] > arr[j + 1]) {
                const temp = arr[j];
                arr[j] = arr[j + 1];
                arr[j + 1] = temp;
              }
            }
          }

          console.log('排序 - 冒泡：', arr);
        }

        //  改进 冒泡
        static bubbleImprove(arr) {
          for (let i = 0;i < arr.length - 1;i ++) {
            let flag = true;
            for (let j = 0;j < arr.length - i -1;j ++) {
              if (arr[j] > arr[j + 1]) {
                const temp = arr[j];
                arr[j] = arr[j + 1];
                arr[j + 1] = temp;
                flag = false;
              }
            }

            if (flag) {
              break;
            }
          }

          console.log('排序 - 冒泡 - 改进：', arr);
        }

        //  选择
        static choose(arr) {
          for (let i = 0;i < arr.length - 1;i++) {
            let minIndex = i;
            for (let j = i + 1;j < arr.length;j++) {
              if (arr[minIndex] > arr[j]) {
                minIndex = j;
              }
            }

            if (minIndex > i) {
              const tmp = arr[minIndex];
              arr[minIndex] = arr[i];
              arr[i] = tmp;
            }
          }

          console.log('排序 - 选择：', arr);
        }

        static insert(arr) {
          for (let i = 1;i < arr.length;i++) {
            const willOrderValue = arr[i];
            for (let j = 0; j < i;j++) {
              if (j === 0 && willOrderValue <= arr[j]) {
                arr.splice(i, 1);
                arr.unshift(willOrderValue);
                break;
              } else if (j < (i - 1) && arr[j] < willOrderValue && arr[j + 1] >= willOrderValue) {
                arr.splice(i, 1);
                arr.splice(j + 1, 0, willOrderValue);
                break;
              }
            }
          }

          console.log('排序 - 插入：', arr);
        }

        static insertOrigin(arr) {
          for (let i = 1;i < arr.length;i ++) {
            for (let j = i;j > 0 && arr[j] < arr[j - 1];j --) {
              // swap(arr, j - 1, j);
              arr.swap(j - 1, j);
            }
          }

          console.info('排序 - 插入 -原始', arr);
        }

        static quick(arr) {
          if (arr.length <= 1) {
            return arr;
          }

          const radix = arr[0];
          const left = [];
          const right = [];
          for (let i = 1;i < arr.length;i++) {
            if (radix > arr[i]) left.push(arr[i]);
            if (radix <= arr[i]) right.push(arr[i]);
          }
          return Sort.quick(left).concat(radix, Sort.quick(right));
        }

        static quickOrigin(arr, start = 0, end = arr.length - 1) {
          if (start >= end) return;

          const radix = partion(arr, start, end);
          Sort.quickOrigin(arr, start, radix - 1);
          Sort.quickOrigin(arr, radix + 1, end);
        }

        static quickImproveThree(arr) {
          let radix = arr[0];
          let i = 1;
          let firstOkIndex = 0;
          let lastOkIndex = arr.length - 1;

          if (lastOkIndex <= 0) {
            // 元素数量不大于2，不用排序了
            return arr;
          }
          while (i <= lastOkIndex) {
            if (arr[i] < radix) {
              const tmp = arr[i];
              arr[i] = arr[firstOkIndex];
              arr[firstOkIndex] = tmp;
              i += 1;
              firstOkIndex += 1;
            } else if (arr[i] > radix) {
              const tmp = arr[i];
              arr[i] = arr[lastOkIndex];
              arr[lastOkIndex] = tmp;
              lastOkIndex -= 1;
            } else {
              i += 1;
            }
          }
          lastOkIndex += 1; // 这里需要加上1，因为最后一次index减去了1，导致radix === arr[lastOkIndex]

          return Sort.quickImproveThree(arr.slice(0, firstOkIndex)).concat(arr.slice(firstOkIndex, lastOkIndex), Sort.quickImproveThree(arr.slice(lastOkIndex)));
        }
      }

      Sort.bubble([324, 5, 32456, 46, 777, 35, 5, 1541, 436, 776, 53, 35]);
      Sort.bubbleImprove([324, 5, 32456, 46, 777, 35, 5, 1541, 436, 776, 53, 35]);
      Sort.choose([324, 5, 32456, 46, 777, 35, 5, 1541, 436, 776, 53, 35]);
      Sort.insert([324, 5, 32456, 46, 777, 35, 5, 1541, 436, 776, 53, 35]);
      Sort.insertOrigin([324, 5, 32456, 46, 777, 35, 5, 1541, 436, 776, 53, 35]);
      console.log('排序 - 快速：', Sort.quick([324, 5, 32456, 46, 777, 35, 5, 1541, 436, 776, 53, 35]));
      const quickOriginArr = [324, 5, 32456, 46, 777, 35, 5, 1541, 436, 776, 53, 35];
      Sort.quickOrigin(quickOriginArr);
      console.log('排序 - 快速 - 原始：', quickOriginArr);
      console.log('排序 - 快速 - 改进三向切分：', Sort.quickImproveThree([324, 5, 32456, 46, 777, 35, 5, 1541, 436, 776, 53, 35]));
    </script>
  </head>
  <body>
    <h1>请看控制台</h1>
    <pre>
       const arr = [324, 5, 32456, 46, 777, 35, 5, 1541, 436, 776, 53, 35];
    </pre>
  </body>
</html>
